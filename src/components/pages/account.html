<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Account</title>
    <link rel="icon" href="/Data/Icon/Home_Page/Icon.png">
    <link
      rel="stylesheet"
      href="../../../bootstrap-5.0.2-dist/css/bootstrap.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <script src="../../../jquery-3.7.1/jquery-3.7.1.min.js"></script>
    <script src="../../../bootstrap-5.0.2-dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="../../css/styles.css" />
  </head>
  <body>
    <header id="header"></header>
    <main class="d-flex">
      <!-- Sidebar -->
      <div
        id="sidebar"
        class="bg-light border-right"
        style="width: 250px; height: 100vh"
      >
        <h5 class="p-3">Tài khoản</h5>
        <ul class="nav flex-column">
          <li class="nav-item">
            <a
              class="nav-link sidebar-link"
              data-target="#profileSection"
              id="profileLink"
              >Hồ sơ</a
            >
          </li>
          <li class="nav-item">
            <a
              class="nav-link sidebar-link"
              data-target="#addressSection"
              id="addressLink"
              >Địa chỉ</a
            >
          </li>
          <li class="nav-item">
            <a
              class="nav-link sidebar-link"
              data-target="#changePasswordSection"
              id="changePasswordLink"
              >Đổi mật khẩu</a
            >
          </li>
        </ul>
      </div>

      <!-- Main Content -->
      <div id="mainContent" class="flex-fill p-4">
        <!-- Hồ sơ -->
        <section id="profileSection" class="content-section active">
          <h2>Thông tin tài khoản</h2>
          <form id="accountForm" autocomplete="on">
            <div class="mb-3">
              <label for="userName" class="form-label">Tên đăng nhập</label>
              <input
                type="text"
                class="form-control"
                id="userName"
                size="20"
                maxlength="20"
              />
            </div>
            <div class="mb-3">
              <label for="fullName" class="form-label">Họ và tên</label>
              <input type="text" class="form-control" id="fullName" />
            </div>

            <div class="mb-3">
              <label for="birthDate" class="form-label">Ngày sinh</label>
              <div class="d-flex">
                <!-- Dropdown cho Ngày -->
                <select
                  id="birthDay"
                  class="form-select me-2"
                  aria-label="Chọn ngày"
                >
                  <option selected disabled>Ngày</option>
                </select>

                <!-- Dropdown cho Tháng -->
                <select
                  id="birthMonth"
                  class="form-select me-2"
                  aria-label="Chọn tháng"
                >
                  <option selected disabled>Tháng</option>
                </select>

                <!-- Dropdown cho Năm -->
                <select
                  id="birthYear"
                  class="form-select"
                  aria-label="Chọn năm"
                >
                  <option selected disabled>Năm</option>
                </select>
              </div>
            </div>

            <div class="mb-3">
              <label for="email" class="form-label">Email</label>
              <input
                type="email"
                class="form-control"
                id="email"
                placeholder="Nhập địa chỉ email"
                pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
              />
            </div>

            <div class="mb-3">
              <label for="phone" class="form-label">Số điện thoại</label>
              <input
                type="text"
                class="form-control"
                id="phone"
                placeholder="Nhập số điện thoại"
                inputmode="numeric"
                pattern="^0 [3-9]\d{8}$"
                maxlength="10"
              />
            </div>

            <button
              type="button"
              id="updateAccountInfo"
              class="btn btn-primary"
            >
              Cập nhật thông tin
            </button>
          </form>

          <!-- Thông báo lỗi hồ sơ -->
          <div id="messageProfile" class="mt-3"></div>
        </section>

        <!-- Địa chỉ -->
        <section id="addressSection" class="content-section d-none">
          <h2>Địa chỉ liên lạc</h2>
          <form id="addressForm" autocomplete="on">
            <!-- Tỉnh/Thành phố -->
            <div class="mb-3">
              <label for="province" class="form-label">Tỉnh/Thành phố</label>
              <select id="province" class="form-select" required>
                <option value="" selected disabled>Chọn Tỉnh/Thành phố</option>
              </select>
            </div>

            <!-- Quận/Huyện -->
            <div class="mb-3">
              <label for="district" class="form-label">Quận/Huyện</label>
              <select id="district" class="form-select" required>
                <option value="" selected disabled>Chọn Quận/Huyện</option>
              </select>
            </div>

            <!-- Phường/Xã -->
            <div class="mb-3">
              <label for="ward" class="form-label">Phường/Xã</label>
              <select id="ward" class="form-select" required>
                <option value="" selected disabled>Chọn Phường/Xã</option>
              </select>
            </div>

            <!-- Số nhà -->
            <div class="mb-3">
              <label for="houseNumber" class="form-label">Số nhà</label>
              <input
                type="text"
                class="form-control"
                id="houseNumber"
                placeholder="Nhập số nhà"
                title="Chỉ cần nhập số nhà"
                maxlength="10"
              />
            </div>

            <!-- Tên đường -->
            <div class="mb-3">
              <label for="streetName" class="form-label">Tên đường</label>
              <input
                type="text"
                class="form-control"
                id="streetName"
                placeholder="Nhập tên đường"
                title="Chỉ cần nhập tên đường"
              />
            </div>

            <button
              type="button"
              id="updateAddressInfo"
              class="btn btn-primary"
            >
              Cập nhật địa chỉ
            </button>
          </form>

          <!-- Thông báo lỗi địa chỉ -->
          <div id="messageAddress" class="mt-3"></div>
        </section>

        <!-- Đổi mật khẩu -->
        <section id="changePasswordSection" class="content-section d-none">
          <h2>Đổi mật khẩu</h2>
          <form id="changePasswordForm">
            <!-- Mật khẩu hiện tại -->
            <div class="mb-3 position-relative">
              <label for="password" class="form-label">Mật khẩu hiện tại</label>
              <input
                type="password"
                class="form-control"
                id="password"
                placeholder="Nhập mật khẩu hiện tại"
              />
              <i
                class="bi bi-eye-slash position-absolute top-50 end-0 translate-middle-y me-3"
                id="togglePassword"
                style="cursor: pointer"
              ></i>
            </div>

            <!-- Mật khẩu mới -->
            <div class="mb-3 position-relative">
              <label for="newPassword" class="form-label">Mật khẩu mới</label>
              <input
                type="password"
                class="form-control"
                id="newPassword"
                placeholder="Nhập mật khẩu mới"
              />
              <i
                class="bi bi-eye-slash position-absolute top-50 end-0 translate-middle-y me-3"
                id="toggleNewPassword"
                style="cursor: pointer"
              ></i>
            </div>

            <!-- Xác nhận mật khẩu mới -->
            <div class="mb-3 position-relative">
              <label for="confirmPassword" class="form-label"
                >Xác nhận mật khẩu mới</label
              >
              <input
                type="password"
                class="form-control"
                id="confirmPassword"
                placeholder="Xác nhận mật khẩu mới"
              />
              <i
                class="bi bi-eye-slash position-absolute top-50 end-0 translate-middle-y me-3"
                id="toggleConfirmPassword"
                style="cursor: pointer"
              ></i>
            </div>

            <button type="submit" class="btn btn-primary">
              Cập nhật mật khẩu
            </button>
          </form>

          <!-- Thông báo lỗi mật khẩu -->
          <div id="messagePassword" class="mt-3"></div>
        </section>
      </div>
    </main>

    <footer id="footer"></footer>

    <script src="../../components/common/header.js"></script>
    <script src="../../components/common/footer.js"></script>
    <script src="../../js/components/main.js"></script>
    <script src="src/js/components/avatar.js"></script>
    <!-- <script src="/src/js/components/avatar.js"></script> -->
  </body>

  <script>
    //Xử lý cho các ô drop down ngày, tháng, năm
    $(document).ready(function () {
      // Tạo các lựa chọn cho dropdown Ngày
      for (let day = 1; day <= 31; day++) {
        $("#birthDay").append(`<option value="${day}">${day}</option>`);
      }

      // Tạo các lựa chọn cho dropdown Tháng
      for (let month = 1; month <= 12; month++) {
        $("#birthMonth").append(`<option value="${month}">${month}</option>`);
      }

      // Tạo các lựa chọn cho dropdown Năm
      const currentYear = new Date().getFullYear();
      for (let year = currentYear; year >= 1900; year--) {
        $("#birthYear").append(`<option value="${year}">${year}</option>`);
      }
    });

    //Xử lý ô nhập email
    $("#email").on("input", function () {
      const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
      const emailInput = $(this).val();

      if (!emailPattern.test(emailInput)) {
        $(this).addClass("is-invalid");
      } else {
        $(this).removeClass("is-invalid");
      }
    });

    // Xử lý ô số điện thoại
    // Chặn ký tự không phải số
    $("#phone").on("input", function () {
      this.value = this.value.replace(/[^0-9]/g, "");
    });

    // Kiểm tra và hiển thị lỗi cho ô nhập số điện thoại
    $("#phone").on("input", function () {
      const phonePattern = /^0[3-9]\d{8}$/;
      const phoneNumber = this.value;

      // Kiểm tra định dạng số điện thoại
      if (!phone || !phonePattern.test(phone)) {
        $("#phone").addClass("is-invalid");
        $("#messageProfile").html(
          '<div class="alert alert-danger">Vui lòng nhập đúng định dạng số điện thoại (Hai số đầu bắt đầu từ 03-09 và có 10 chữ số)!</div>'
        );
        return;
      } else {
        $("#phone").removeClass("is-invalid");
      }
    });

    //Xử lý khi nhấn vào nút cập nhật thông tin
    $(document).ready(function () {
      // Xử lý khi nhấn vào nút "Cập nhật thông tin"
      $("#updateAccountInfo").on("click", function () {
        // Lấy giá trị từ các ô input
        const userName = $("#userName").val().trim();
        const fullName = $("#fullName").val().trim();
        const email = $("#email").val().trim();
        const phone = $("#phone").val().trim();

        // Regex kiểm tra định dạng email và số điện thoại
        const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        const phonePattern = /^0[3-9]\d{8}$/;

        // Kiểm tra các trường bắt buộc không được bỏ trống
        if (!userName) {
          $("#userName").addClass("is-invalid");
          $("#messageProfile").html(
            '<div class="alert alert-danger">Vui lòng nhập Tên đăng nhập!</div>'
          );
          return;
        } else {
          $("#userName").removeClass("is-invalid");
        }

        if (!fullName) {
          $("#fullName").addClass("is-invalid");
          $("#messageProfile").html(
            '<div class="alert alert-danger">Vui lòng nhập Họ và tên!</div>'
          );
          return;
        } else {
          $("#fullName").removeClass("is-invalid");
        }

        // Kiểm tra định dạng email
        if (!email || !emailPattern.test(email)) {
          $("#email").addClass("is-invalid");
          $("#messageProfile").html(
            '<div class="alert alert-danger">Vui lòng nhập đúng định dạng Email (ví dụ: example@gmail.com)!</div>'
          );
          return;
        } else {
          $("#email").removeClass("is-invalid");
        }

        // Kiểm tra định dạng số điện thoại
        if (!phone || !phonePattern.test(phone)) {
          $("#phone").addClass("is-invalid");
          $("#messageProfile").html(
            '<div class="alert alert-danger">Vui lòng nhập đúng định dạng số điện thoại (Hai số đầu bắt đầu từ 03-09 và có 10 chữ số)!</div>'
          );
          return;
        } else {
          $("#phone").removeClass("is-invalid");
        }

        $("#messageProfile").html(
          '<div class="alert alert-success">Cập nhật thông tin tài khoản thành công!</div>'
        );
      });
    });

    //Xử lý khi nhấn vào icon con mắt
    $(document).ready(function () {
      // Toggle mật khẩu hiện tại
      $("#togglePassword").on("click", function () {
        const passwordField = $("#password");
        const type =
          passwordField.attr("type") === "password" ? "text" : "password";
        passwordField.attr("type", type);
        $(this).toggleClass("bi-eye bi-eye-slash");
      });

      // Toggle mật khẩu mới
      $("#toggleNewPassword").on("click", function () {
        const newPasswordField = $("#newPassword");
        const icon = $(this);
        if (newPasswordField.attr("type") === "password") {
          newPasswordField.attr("type", "text");
          icon.removeClass("bi-eye-slash").addClass("bi-eye");
        } else {
          newPasswordField.attr("type", "password");
          icon.removeClass("bi-eye").addClass("bi-eye-slash");
        }
      });

      // Toggle xác nhận mật khẩu mới
      $("#toggleConfirmPassword").on("click", function () {
        const confirmPasswordField = $("#confirmPassword");
        const icon = $(this);
        if (confirmPasswordField.attr("type") === "password") {
          confirmPasswordField.attr("type", "text");
          icon.removeClass("bi-eye-slash").addClass("bi-eye");
        } else {
          confirmPasswordField.attr("type", "password");
          icon.removeClass("bi-eye").addClass("bi-eye-slash");
        }
      });
    });

    //Fetch API tỉnh thành Việt Nam
    // API URLs
    const API_PROVINCE = "https://provinces.open-api.vn/api/?depth=1";
    const API_DISTRICT = (provinceCode) =>
      `https://provinces.open-api.vn/api/p/${provinceCode}?depth=2`;
    const API_WARD = (districtCode) =>
      `https://provinces.open-api.vn/api/d/${districtCode}?depth=2`;

    // Elements
    const provinceSelect = document.getElementById("province");
    const districtSelect = document.getElementById("district");
    const wardSelect = document.getElementById("ward");

    // Fetch Provinces
    // Mới thêm từ chatGPT

    // Lưu danh sách các tỉnh, huyện, xã để tìm kiếm
    let provincesList = []; // Sẽ lưu các tỉnh
    let districtsList = {}; // Sẽ lưu các quận/huyện theo mã tỉnh
    let wardsList = {}; // Sẽ lưu các phường/xã theo mã quận

    // Fetch Provinces
    async function fetchProvinces() {
      try {
        const response = await fetch(API_PROVINCE);
        const provinces = await response.json();
        provincesList = provinces; // Lưu danh sách tỉnh vào biến toàn cục
        console.log(provincesList); // Kiểm tra xem các tỉnh đã được tải chưa
        provinces.forEach((province) => {
          const option = document.createElement("option");
          option.value = province.code;
          option.textContent = province.name;
          provinceSelect.appendChild(option);
        });
      } catch (error) {
        console.error("Lỗi khi lấy danh sách tỉnh/thành phố:", error);
      }
    }

    // Fetch Districts
    async function fetchDistricts(provinceCode) {
      districtSelect.innerHTML = '<option value="">Chọn Quận/Huyện</option>';
      wardSelect.innerHTML = '<option value="">Chọn Phường/Xã</option>';
      districtSelect.disabled = false;

      if (!provinceCode) return;

      try {
        const response = await fetch(API_DISTRICT(provinceCode));
        const { districts } = await response.json();
        districtsList[provinceCode] = districts; // Lưu danh sách quận huyện theo tỉnh

        districts.forEach((district) => {
          const option = document.createElement("option");
          option.value = district.code;
          option.textContent = district.name;
          districtSelect.appendChild(option);
        });
      } catch (error) {
        console.error("Lỗi khi lấy danh sách quận/huyện:", error);
      }
    }

    // Fetch Wards
    async function fetchWards(districtCode) {
      wardSelect.innerHTML = '<option value="">Chọn Phường/Xã</option>';
      wardSelect.disabled = false;

      if (!districtCode) return;

      try {
        const response = await fetch(API_WARD(districtCode));
        const { wards } = await response.json();
        wardsList[districtCode] = wards; // Lưu danh sách phường xã theo quận

        wards.forEach((ward) => {
          const option = document.createElement("option");
          option.value = ward.code;
          option.textContent = ward.name;
          wardSelect.appendChild(option);
        });
      } catch (error) {
        console.error("Lỗi khi lấy danh sách phường/xã:", error);
      }
    }

    // Khi trang đã được load, tìm mã tỉnh, quận, phường từ thông tin user
    document.addEventListener("DOMContentLoaded", async () => {
      await fetchProvinces(); // Đợi tỉnh được tải về

      const loggedUser = JSON.parse(localStorage.getItem("loggedUser"));
      if (loggedUser && loggedUser.status) {
        const user = loggedUser.user;

        // Điền thông tin vào dropdown Tỉnh/Thành phố
        const province = provincesList.find(
          (p) => p.name === user.diaChi.tinhThanh
        );
        if (province) {
          provinceSelect.value = province.code;
          await fetchDistricts(province.code); // Lấy quận/huyện sau khi tỉnh đã chọn
        }

        // Sau khi tỉnh được chọn, điền quận/huyện
        const districts = districtsList[provinceSelect.value] || [];
        const district = districts.find(
          (d) => d.name === user.diaChi.quanHuyen
        );
        if (district) {
          districtSelect.value = district.code;
          await fetchWards(district.code); // Lấy phường/xã sau khi quận đã chọn
        }

        // Sau khi quận được chọn, điền phường/xã
        const wards = wardsList[districtSelect.value] || [];
        const ward = wards.find((w) => w.name === user.diaChi.phuongXa);
        if (ward) {
          wardSelect.value = ward.code;
        }

        // Điền các thông tin khác
        // document.getElementById("houseNumber").value = user.diaChi.soNha;
        // document.getElementById("streetName").value = user.diaChi.tenDuong;
      }
    });

    // Khi người dùng chọn tỉnh
    provinceSelect.addEventListener("change", async (event) => {
      const provinceCode = event.target.value;
      await fetchDistricts(provinceCode); // Lấy danh sách quận/huyện cho tỉnh
      wardSelect.disabled = true;
      districtSelect.value = "";
      wardSelect.value = "";
    });

    // Khi người dùng chọn quận
    districtSelect.addEventListener("change", async (event) => {
      const districtCode = event.target.value;
      await fetchWards(districtCode); // Lấy danh sách phường/xã cho quận
      wardSelect.value = "";
    });

    // Xử lý cho các ô dropdown Tỉnh/Thành phố, Quận/Huyện, Phường/Xã
    $(document).ready(function () {
      // Sự kiện khi người dùng thay đổi Tỉnh/Thành phố
      $("#province").on("change", function () {
        if ($(this).val() === "") {
          $(this).addClass("is-invalid");
          $("#messageAddress").html(
            '<div class="alert alert-danger">Vui lòng chọn Tỉnh/Thành phố!</div>'
          );
        } else {
          $(this).removeClass("is-invalid");
        }
      });

      // Sự kiện khi người dùng thay đổi Quận/Huyện
      $("#district").on("change", function () {
        if ($(this).val() === "") {
          $(this).addClass("is-invalid");
          $("#messageAddress").html(
            '<div class="alert alert-danger">Vui lòng chọn Quận/Huyện!</div>'
          );
        } else {
          $(this).removeClass("is-invalid");
        }
      });

      // Sự kiện khi người dùng thay đổi Phường/Xã
      $("#ward").on("change", function () {
        if ($(this).val() === "") {
          $(this).addClass("is-invalid");
          $("#messageAddress").html(
            '<div class="alert alert-danger">Vui lòng chọn Phường/Xã!</div>'
          );
        } else {
          $(this).removeClass("is-invalid");
        }
      });
    });

    // Xử lý ô nhập Số nhà
    $("#houseNumber").on("input", function () {
      // Biểu thức chính quy cho phép số nhà chữ cái, số, dấu cách và ký tự '/'
      const houseNumberPattern = /^[a-zA-Z0-9\s/]{1,10}$/;
      const houseNumber = $(this).val();

      if (!houseNumberPattern.test(houseNumber)) {
        $(this).addClass("is-invalid");
        $("#messageAddress").html(
          '<div class="alert alert-danger">Số nhà chỉ chứa chữ, số, dấu cách và ký tự "/" tối đa 10 ký tự!</div>'
        );
      } else {
        $(this).removeClass("is-invalid");
        $("#messageAddress").empty();
      }
    });

    // Xử lý ô nhập Tên đường
    $("#streetName").on("input", function () {
      const streetNamePattern = /^[a-zA-Z0-9\s\/]+$/;
      const streetName = $(this).val();

      if (!streetNamePattern.test(streetName)) {
        $(this).addClass("is-invalid");
        $("#messageAddress").html(
          '<div class="alert alert-danger">Tên đường chỉ chứa chữ cái và khoảng trắng, không có ký tự đặc biệt!</div>'
        );
      } else {
        $(this).removeClass("is-invalid");
        $("#messageAddress").empty();
      }
    });

    // Xử lý khi nhấn nút "Cập nhật địa chỉ"
    $(document).ready(function () {
      $("#updateAddressInfo").on("click", function () {
        const province = $("#province").val();
        const district = $("#district").val();
        const ward = $("#ward").val();

        const houseNumber = $("#houseNumber").val().trim();
        const houseNumberPattern = /^[a-zA-Z0-9\s/]{1,10}$/;

        const streetName = $("#streetName").val().trim();
        const streetNamePattern = /^[a-zA-Z0-9\s\/]+$/;

        // Kiểm tra các trường dropdown
        if (!province || !district || !ward) {
          $("#messageAddress").html(
            '<div class="alert alert-danger">Vui lòng chọn đầy đủ Tỉnh/Thành phố, Quận/Huyện và Phường/Xã!</div>'
          );
          return;
        }

        // Kiểm tra trường số nhà
        if (!houseNumber || !houseNumberPattern.test(houseNumber)) {
          $("#houseNumber").addClass("is-invalid");
          $("#messageAddress").html(
            '<div class="alert alert-danger">Vui lòng nhập số nhà!</div>'
          );
          return;
        } else {
          $("#houseNumber").removeClass("is-invalid");
        }
        // Kiểm tra trường tên đường
        if (!streetName || !streetNamePattern.test(streetName)) {
          $("#streetName").addClass("is-invalid");
          $("#messageAddress").html(
            '<div class="alert alert-danger">Vui lòng nhập tên đường!</div>'
          );
          return;
        } else {
          $("#streetName").removeClass("is-invalid");
        }

        // Nếu tất cả đều hợp lệ
        $("#messageAddress").html(
          '<div class="alert alert-success">Cập nhật địa chỉ thành công!</div>'
        );
      });
    });

    // Xử lý sidebar
    $("#sidebar .nav-link").on("click", function () {
      $("#sidebar .nav-link").removeClass("active");
      $(this).addClass("active");
      $(".content-section").removeClass("active").addClass("d-none");
      const targetId = $(this).attr("href");
      $(targetId).removeClass("d-none").addClass("active");
    });

    // Xử lý khi submit form đổi mật khẩu
    $("#changePasswordForm").on("submit", function (e) {
      e.preventDefault();
      let currentPassword = $("#password").val();
      let newPassword = $("#newPassword").val();
      let confirmPassword = $("#confirmPassword").val();

      // Kiểm tra mật khẩu cũ và mật khẩu mới
      if (newPassword === currentPassword) {
        $("#messagePassword").html(
          '<div class="alert alert-danger">Mật khẩu mới không thể trùng với mật khẩu cũ!</div>'
        );
        return;
      }

      // Kiểm tra nếu các trường mật khẩu trống
      if (!currentPassword || !newPassword || !confirmPassword) {
        $("#messagePassword").html(
          '<div class="alert alert-danger">Tất cả các trường mật khẩu đều là bắt buộc!</div>'
        );
        return;
      }

      // Kiểm tra mật khẩu mới và xác nhận mật khẩu
      if (newPassword !== confirmPassword) {
        $("#messagePassword").html(
          '<div class="alert alert-danger">Mật khẩu mới và xác nhận không khớp!</div>'
        );
      } else {
        // Gửi thông tin cập nhật lên server hoặc xử lý ở đây
        $("#messagePassword").html(
          '<div class="alert alert-success">Cập nhật thông tin thành công!</div>'
        );
      }
    });

    //Thêm từ chatGPT
    // Xử lý khi nhấn vào các mục trong sidebar
    $(document).ready(function () {
      // Chỉ xử lý các liên kết có class 'sidebar-link'
      $(".sidebar-link").on("click", function (e) {
        e.preventDefault(); // Ngăn hành vi mặc định của thẻ <a>

        // Bỏ lớp 'active' khỏi tất cả liên kết sidebar
        $(".sidebar-link").removeClass("active");

        // Thêm lớp 'active' cho liên kết được nhấn
        $(this).addClass("active");

        // Lấy ID của section mục tiêu từ thuộc tính data-target
        const targetSection = $(this).data("target");

        // Ẩn tất cả các section
        $(".content-section").addClass("d-none");

        // Hiển thị section mục tiêu
        $(targetSection).removeClass("d-none");
      });
    });

    //Mới thêm từ chatGPT
    // Lấy dữ liệu từ localStorage
    const loggedUser = JSON.parse(localStorage.getItem("loggedUser"));

    // Kiểm tra nếu người dùng đã đăng nhập
    if (loggedUser && loggedUser.status) {
      const user = loggedUser.user;

      // Điền thông tin vào các ô trong form Hồ sơ
      document.getElementById("fullName").value = user.hoTen; // Họ và tên

      // Điền ngày sinh vào các ô dropdown
      const birthDate = new Date(user.ngaySinh); // Giả sử ngày sinh có định dạng "dd-mm-yyyy"
      const birthDay = birthDate.getDate();
      const birthMonth = birthDate.getMonth() + 1; // Lưu ý tháng bắt đầu từ 0
      const birthYear = birthDate.getFullYear();

      // Cập nhật các dropdown ngày, tháng, năm
      for (let i = 1; i <= 31; i++) {
        const option = document.createElement("option");
        option.value = i;
        option.text = i;
        document.getElementById("birthDay").appendChild(option);
      }
      document.getElementById("birthDay").value = birthDay;

      for (let i = 1; i <= 12; i++) {
        const option = document.createElement("option");
        option.value = i;
        option.text = i;
        document.getElementById("birthMonth").appendChild(option);
      }
      document.getElementById("birthMonth").value = birthMonth;

      // Tạo các options cho năm, giả sử năm hiện tại và các năm trước đó
      const currentYear = new Date().getFullYear();
      for (let i = currentYear; i >= 1900; i--) {
        const option = document.createElement("option");
        option.value = i;
        option.text = i;
        document.getElementById("birthYear").appendChild(option);
      }
      document.getElementById("birthYear").value = birthYear;

      // Điền thông tin email và số điện thoại
      document.getElementById("email").value = user.email;
      document.getElementById("phone").value = user.soDienThoai;

      // Điền địa chỉ vào các ô tương ứng
      document.getElementById("province").value = user.diaChi.tinhThanh;
      document.getElementById("district").value = user.diaChi.quanHuyen;
      document.getElementById("ward").value = user.diaChi.phuongXa;
      document.getElementById("houseNumber").value = user.diaChi.soNha;
      document.getElementById("streetName").value = user.diaChi.tenDuong;

      // Kiểm tra các dropdown để đảm bảo có giá trị
      console.log(document.getElementById("province").options);
      console.log(document.getElementById("district").options);
      console.log(document.getElementById("ward").options);

      console.log(document.getElementById("province").value);
      console.log(document.getElementById("district").value);
      console.log(document.getElementById("ward").value);
    }

    //Mới thêm từ chatGPT
    // Hàm để cập nhật thông tin tài khoản
    document
      .getElementById("updateAccountInfo")
      .addEventListener("click", function () {
        // Lấy dữ liệu từ các trường nhập liệu
        const userName = document.getElementById("userName").value;
        const fullName = document.getElementById("fullName").value;
        const birthDay = document.getElementById("birthDay").value;
        const birthMonth = document.getElementById("birthMonth").value;
        const birthYear = document.getElementById("birthYear").value;
        const email = document.getElementById("email").value;
        const phone = document.getElementById("phone").value;

        // Kiểm tra dữ liệu hợp lệ
        if (
          userName &&
          fullName &&
          birthDay &&
          birthMonth &&
          birthYear &&
          email &&
          phone
        ) {
          // Lấy đối tượng loggedUser từ localStorage
          let loggedUser = JSON.parse(localStorage.getItem("loggedUser")) || {
            status: false,
            user: {},
            cart: [],
            order: [],
          };

          // Cập nhật thông tin user
          loggedUser.user = {
            ...loggedUser.user, // Giữ nguyên các dữ liệu cũ
            hoTen: fullName,
            ngaySinh: `${birthDay}-${birthMonth}-${birthYear}`,
            email: email,
            soDienThoai: phone,
          };

          // Cập nhật lại vào localStorage
          localStorage.setItem("loggedUser", JSON.stringify(loggedUser));

          // Hiển thị thông báo thành công
          document.getElementById("messageProfile").innerHTML =
            '<p class="text-success">Cập nhật thông tin thành công!</p>';
        } else {
          // Hiển thị thông báo lỗi nếu thiếu trường
          document.getElementById("messageProfile").innerHTML =
            '<p class="text-danger">Vui lòng điền đầy đủ thông tin.</p>';
        }
      });

    // Lắng nghe sự kiện khi người dùng cập nhật thông tin địa chỉ
    document
      .getElementById("updateAddressInfo")
      .addEventListener("click", function () {
        // Lấy dữ liệu từ các trường nhập liệu địa chỉ
        const province = document.getElementById("province").value;
        const district = document.getElementById("district").value;
        const ward = document.getElementById("ward").value;
        const houseNumber = document.getElementById("houseNumber").value;
        const streetName = document.getElementById("streetName").value;

        // Kiểm tra dữ liệu hợp lệ
        if (province && district && ward && houseNumber && streetName) {
          // Lấy đối tượng loggedUser từ localStorage
          let loggedUser = JSON.parse(localStorage.getItem("loggedUser")) || {
            status: false,
            user: {},
            cart: [],
            order: [],
          };

          // Cập nhật thông tin địa chỉ
          loggedUser.user.address = {
            province: province,
            district: district,
            ward: ward,
            houseNumber: houseNumber,
            streetName: streetName,
          };

          // Cập nhật lại vào localStorage
          localStorage.setItem("loggedUser", JSON.stringify(loggedUser));

          // Hiển thị thông báo thành công
          document.getElementById("messageAddress").innerHTML =
            '<p class="text-success">Cập nhật địa chỉ liên lạc thành công!</p>';
        } else {
          // Hiển thị thông báo lỗi nếu thiếu trường
          document.getElementById("messageAddress").innerHTML =
            '<p class="text-danger">Vui lòng điền đầy đủ thông tin địa chỉ.</p>';
        }
      });

    // Lắng nghe sự kiện khi người dùng cập nhật mật khẩu
    document
      .getElementById("changePasswordForm")
      .addEventListener("submit", function (event) {
        event.preventDefault(); // Ngừng hành động mặc định của form (nếu có)

        // Lấy dữ liệu từ các trường nhập liệu mật khẩu
        const currentPassword = document.getElementById("password").value;
        const newPassword = document.getElementById("newPassword").value;
        const confirmPassword =
          document.getElementById("confirmPassword").value;

        // Kiểm tra mật khẩu hiện tại, mật khẩu mới và xác nhận mật khẩu
        if (currentPassword && newPassword && confirmPassword) {
          // Lấy đối tượng loggedUser từ localStorage
          let loggedUser = JSON.parse(localStorage.getItem("loggedUser")) || {
            status: false,
            user: {},
            cart: [],
            order: [],
          };

          // Kiểm tra mật khẩu hiện tại có đúng không
          if (loggedUser.user.password !== currentPassword) {
            document.getElementById("messagePassword").innerHTML =
              '<p class="text-danger">Mật khẩu hiện tại không chính xác.</p>';
            return;
          }

          // Kiểm tra mật khẩu mới và xác nhận mật khẩu có khớp không
          if (newPassword !== confirmPassword) {
            document.getElementById("messagePassword").innerHTML =
              '<p class="text-danger">Mật khẩu mới và xác nhận mật khẩu không khớp.</p>';
            return;
          }

          // Cập nhật mật khẩu mới
          loggedUser.user.password = newPassword;

          // Lưu lại vào localStorage
          localStorage.setItem("loggedUser", JSON.stringify(loggedUser));

          // Hiển thị thông báo thành công
          document.getElementById("messagePassword").innerHTML =
            '<p class="text-success">Cập nhật mật khẩu thành công!</p>';
        } else {
          // Hiển thị thông báo lỗi nếu thiếu trường
          document.getElementById("messagePassword").innerHTML =
            '<p class="text-danger">Vui lòng điền đầy đủ mật khẩu.</p>';
        }
      });
  </script>
</html>
